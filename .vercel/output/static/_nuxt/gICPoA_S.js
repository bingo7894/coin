import{h as Z,r as d,aq as f,S as M,u as R,j as nn}from"./BYeEcd1H.js";import{g as en,a as on,b as tn,U as an}from"./DLqlWRaA.js";function un(l){return window&&"requestIdleCallback"in window?requestIdleCallback(l):setTimeout(()=>l(),1)}const dn=Z({__name:"CldUploadWidget",props:{options:{},signatureEndpoint:{},uploadPreset:{},config:{},tags:{},onOpen:{type:Function},onUpload:{type:Function},onAbort:{type:Function},onBatchCancelled:{type:Function},onClose:{type:Function},onDisplayChanged:{type:Function},onPublicId:{type:Function},onQueuesEnd:{type:Function},onQueuesStart:{type:Function},onRetry:{type:Function},onShowCompleted:{type:Function},onSourceChanged:{type:Function},onSuccess:{type:Function},onTags:{type:Function},onUploadAdded:{type:Function},onError:{type:Function},onResult:{type:Function}},setup(l){var D;const u=l,{onClose:g,onError:r,onOpen:v,onUpload:h,options:m,signatureEndpoint:w,uploadPreset:T,onAbort:q,onBatchCancelled:z,onDisplayChanged:K,onPublicId:L,onQueuesEnd:Q,onQueuesStart:$,onRetry:N,onShowCompleted:j,onSourceChanged:B,onSuccess:x,onTags:G,onUploadAdded:H,config:V}=u,p=d(),e=d(),s=d(),o=d(),C=d(!0),b={close:S,destroy:E,hide:U,isDestroyed:O,isMinimized:A,isShowing:_,minimize:I,open:k,show:P,update:W,abort:q,"batch-cancelled":z,"display-changed":K,publicid:L,"queues-end":Q,"queues-start":$,retry:N,"show-completed":j,"source-changed":B,success:x,tags:G,"upload-added":H},J=w&&on({signatureEndpoint:String(w),fetch}),y=en({uploadPreset:T||f().public.cloudinary.uploadPreset,apiKey:f().public.cloudinary.apiKey,uploadSignature:J,...m},{cloud:{cloudName:f().public.cloudinary.cloudName,apiKey:f().public.cloudinary.apiKey},...m,...b,...V}),X=tn({onError:n=>{s.value=n,typeof r=="function"&&o.value&&r(n,o.value)},onResult:n=>{if(typeof(n==null?void 0:n.event)!="string")return;o.value=n;const i=an[n.event];if(typeof i=="string"&&typeof u[i]=="function"){const c=u[i];c(n,{widget:e.value.current,...b})}const a=`${i}Action`;if(a&&typeof u[a]=="function"){const c=u[a];c(n)}}});(D=u.tags)!=null&&D.length&&(y.showAdvancedOptions=!0,y.getTags=(n,i)=>{var a;return n(i?(a=u.tags)==null?void 0:a.filter(c=>!c.indexOf(i)):u.tags)}),M(o,()=>{var a,c;if(typeof o.value>"u")return;const n=((a=o.value)==null?void 0:a.event)==="success",i=((c=o.value)==null?void 0:c.event)==="display-changed"&&o.value.info==="hidden";n&&typeof h=="function"&&h(o.value),i&&typeof g=="function"&&g(e.value)}),M(s,()=>{s.value&&typeof r=="function"&&r(s.value,e.value)});function Y(){C.value=!1,p.value||"cloudinary"in window&&(p.value=window.cloudinary),un(()=>{e.value||(e.value=F())})}function F(){return p.value.createUploadWidget(y,X)}function t(n){e.value||(e.value=F()),typeof(e==null?void 0:e.value[n])=="function"&&e.value[n]()}function S(){t("close")}function E(){t("destroy")}function U(){t("hide")}function O(){t("isDestroyed")}function A(){t("isMinimized")}function _(){t("isShowing")}function I(){t("minimize")}function P(){t("show")}function W(){t("update")}function k(){t("open"),typeof v=="function"&&v(e.value)}return R({script:[{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onload:Y,onerror:n=>console.error(`Failed to load Cloudinary Upload Widget: ${n.message}`)}]}),(n,i)=>nn(n.$slots,"default",{cloudinary:p.value,widget:e.value,open:k,update:W,show:P,isShowing:_,isMinimized:A,isDestroyed:O,destroy:E,close:S,hide:U,minimize:I,results:o.value,error:s.value,isLoading:C.value})}});export{dn as _};
