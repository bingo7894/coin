import{_ as $,a as D}from"./CX95B2aT.js";import{h as j,a6 as N,a7 as R,g as T,c as x,b as i,a as t,w as B,t as d,a1 as c,k as O,d as y,F as U,V as E,e as F,o as g,a4 as H}from"./BYeEcd1H.js";import{u as I}from"./CQugv8yJ.js";const M={class:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100"},q={class:"p-6"},z={class:"max-w-2xl mx-auto space-y-8"},A={class:"flex items-center justify-between"},K={class:"text-sm text-gray-500"},P={key:0,class:"text-center p-12"},G={key:1,class:"bg-red-50 border border-red-200 p-6 rounded-2xl"},J={class:"flex items-center space-x-3"},Q={key:2,class:"space-y-8"},W={class:"bg-white p-8 rounded-3xl shadow-lg border border-gray-200"},X={class:"bg-gradient-to-r from-blue-50 to-indigo-50 p-8 rounded-2xl border border-blue-200 text-center"},Y={class:"space-y-4"},Z={class:"text-5xl font-bold text-blue-600 mb-2"},tt={class:"border-t border-blue-200 pt-4"},et={class:"text-3xl font-semibold text-blue-800"},st={key:0,class:"bg-white p-8 rounded-3xl shadow-lg border border-gray-200"},ot={class:"text-xl font-bold text-gray-800 mb-6 flex items-center"},nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},rt={class:"flex items-center justify-between"},lt={class:"flex items-center space-x-3"},at={class:"w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center"},it={class:"text-yellow-600 font-bold text-sm"},dt={class:"font-semibold text-gray-800"},ct={class:"text-sm text-gray-600"},ut={class:"text-right"},xt={class:"text-2xl font-bold text-gray-900"},gt={class:"mt-4 pt-4 border-t border-gray-200"},mt={class:"flex justify-between items-center"},bt={class:"font-semibold text-green-600"},pt={class:"bg-white p-8 rounded-3xl shadow-lg border border-gray-200"},_t={class:"text-xl font-bold text-gray-800 mb-6 flex items-center"},vt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ft={class:"text-center p-4 bg-green-50 rounded-xl"},ht={class:"text-2xl font-bold text-green-600"},yt={class:"text-center p-4 bg-orange-50 rounded-xl"},wt={class:"text-2xl font-bold text-orange-600"},Lt={class:"flex flex-col sm:flex-row gap-4"},St={key:3,class:"text-center p-12"},jt=j({__name:"index",async setup(Vt){var f;let b,_;const p=((f=N().query.ids)==null?void 0:f.split(","))||[],v=n=>{switch(n){case"050":return .5;case"025":return .25;case"1":return 1;case"2":return 2;case"5":return 5;case"10":return 10;default:return Number(n)}},w=n=>{switch(n){case"050":return"0.5";case"025":return"0.25";default:return n}},{data:m,pending:L,error:S}=([b,_]=R(()=>I("/api/report",{method:"POST",body:{ids:p},lazy:!1},"$mh-9UM5KMi")),b=await b,_(),b),o=T(()=>{if(!m.value||m.value.length===0)return null;const n=m.value.reduce((s,a)=>{const l=a.details.reduce((k,h)=>k+h.count*v(h.type.toString()),0);return s+l},0),e=m.value.reduce((s,a)=>s+a.totalCount,0),u={};m.value.forEach(s=>{s.details.forEach(a=>{const l=a.type.toString();u[l]||(u[l]=0),u[l]+=a.count})});const r=Object.entries(u).map(([s,a])=>({type:s,count:a,value:v(s),displayValue:w(s)})).sort((s,a)=>a.value-s.value);return{totalValue:n,totalCoins:e,aggregatedDetails:r}}),V=()=>{if(!o.value)return;const n=`
รายงานสรุปเหรียญ
=================
มูลค่ารวม: ${o.value.totalValue.toLocaleString()} บาท
จำนวนเหรียญทั้งหมด: ${o.value.totalCoins.toLocaleString()} เหรียญ

รายละเอียด:
${o.value.aggregatedDetails.map(s=>`- เหรียญ ${s.displayValue} บาท: ${s.count.toLocaleString()} เหรียญ (${(s.count*s.value).toLocaleString()} บาท)`).join(`
`)}

สร้างเมื่อ: ${new Date().toLocaleDateString("th-TH")}
  `,e=new Blob([n],{type:"text/plain;charset=utf-8"}),u=URL.createObjectURL(e),r=document.createElement("a");r.href=u,r.download=`coin-report-${new Date().toISOString().split("T")[0]}.txt`,r.click(),URL.revokeObjectURL(u)},C=async()=>{if(!o.value)return;const n=`รายงานสรุปเหรียญ
มูลค่ารวม: ${o.value.totalValue.toLocaleString()} บาท
จำนวนเหรียญ: ${o.value.totalCoins.toLocaleString()} เหรียญ`;if(navigator.share)try{await navigator.share({title:"รายงานสรุปเหรียญ",text:n})}catch{console.log("การแชร์ถูกยกเลิก")}else await navigator.clipboard.writeText(n),alert("คัดลอกรายงานไปยังคลิปบอร์ดแล้ว")};return(n,e)=>{const u=$,r=H,s=F,a=D;return g(),x("div",M,[i(u),t("main",q,[t("div",z,[t("div",A,[i(s,{to:"/history",class:"flex items-center space-x-2 text-blue-600 hover:text-blue-800 hover:underline transition-colors"},{default:B(()=>[i(r,{name:"lucide:arrow-left",class:"w-5 h-5"}),e[0]||(e[0]=t("span",{class:"font-medium"},"กลับไปที่ประวัติ",-1))]),_:1,__:[0]}),t("div",K,"รวม "+d(c(p).length)+" รายการ",1)]),c(L)?(g(),x("div",P,e[1]||(e[1]=[t("div",{class:"inline-flex items-center space-x-3"},[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t("p",{class:"text-gray-600 font-medium"},"กำลังสร้างรายงานสรุป...")],-1)]))):c(S)?(g(),x("div",G,[t("div",J,[i(r,{name:"lucide:alert-circle",class:"w-6 h-6 text-red-500"}),e[2]||(e[2]=t("div",null,[t("h3",{class:"font-semibold text-red-800"},"ไม่พบรายงาน"),t("p",{class:"text-red-700"},"เลือกข้อมูลที่หน้าประวัติเพื่อทำรายงาน")],-1))])])):c(o)?(g(),x("div",Q,[t("section",W,[e[5]||(e[5]=t("div",{class:"text-center mb-6"},[t("h2",{class:"text-2xl font-bold text-gray-800 mb-2"},"รายงานสรุป"),t("p",{class:"text-gray-600"},"สรุปมูลค่าเหรียญทั้งหมด")],-1)),t("div",X,[t("div",Y,[t("div",null,[t("div",Z,d(c(o).totalValue.toLocaleString()),1),e[3]||(e[3]=t("div",{class:"text-xl text-blue-700 font-medium"},"บาท",-1))]),t("div",tt,[t("div",et,d(c(o).totalCoins.toLocaleString()),1),e[4]||(e[4]=t("div",{class:"text-lg text-blue-700"},"เหรียญทั้งหมด",-1))])])])]),c(o).aggregatedDetails.length>0?(g(),x("section",st,[t("h3",ot,[i(r,{name:"lucide:coins",class:"w-6 h-6 mr-2 text-yellow-500"}),e[6]||(e[6]=y(" รายละเอียดเหรียญแต่ละประเภท "))]),t("div",nt,[(g(!0),x(U,null,E(c(o).aggregatedDetails,l=>(g(),x("div",{key:l.type,class:"group hover:shadow-md transition-shadow bg-gray-50 hover:bg-gray-100 p-6 rounded-xl border border-gray-200"},[t("div",rt,[t("div",lt,[t("div",at,[t("span",it,d(l.displayValue),1)]),t("div",null,[t("div",dt,d(l.displayValue)+" บาท ",1),t("div",ct," เหรียญ "+d(l.displayValue)+" บาท ",1)])]),t("div",ut,[t("div",xt,d(l.count.toLocaleString()),1),e[7]||(e[7]=t("div",{class:"text-sm text-gray-600"},"เหรียญ",-1))])]),t("div",gt,[t("div",mt,[e[8]||(e[8]=t("span",{class:"text-sm text-gray-600"},"มูลค่ารวม",-1)),t("span",bt,d((l.count*l.value).toLocaleString())+" บาท ",1)])])]))),128))])])):O("",!0),t("section",pt,[t("h3",_t,[i(r,{name:"lucide:bar-chart-3",class:"w-6 h-6 mr-2 text-green-500"}),e[9]||(e[9]=y(" สถิติเพิ่มเติม "))]),t("div",vt,[t("div",ft,[t("div",ht,d(c(o).aggregatedDetails.length),1),e[10]||(e[10]=t("div",{class:"text-sm text-green-700"},"ประเภทเหรียญ",-1))]),t("div",yt,[t("div",wt,d(c(p).length),1),e[11]||(e[11]=t("div",{class:"text-sm text-orange-700"},"ครั้งที่นับ",-1))])])]),t("section",Lt,[t("button",{onClick:V,class:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-xl transition-colors flex items-center justify-center space-x-2"},[i(r,{name:"lucide:download",class:"w-5 h-5"}),e[12]||(e[12]=t("span",null,"ส่งออกรายงาน",-1))]),t("button",{onClick:C,class:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-xl transition-colors flex items-center justify-center space-x-2"},[i(r,{name:"lucide:share-2",class:"w-5 h-5"}),e[13]||(e[13]=t("span",null,"แชร์รายงาน",-1))])])])):(g(),x("div",St,[i(r,{name:"lucide:file-x",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e[14]||(e[14]=t("h3",{class:"text-lg font-semibold text-gray-600 mb-2"},"ไม่พบข้อมูล",-1)),e[15]||(e[15]=t("p",{class:"text-gray-500"},"ไม่พบข้อมูลสำหรับสร้างรายงาน",-1))]))]),e[16]||(e[16]=t("div",{class:"p-12"},null,-1))]),i(a)])}}});export{jt as default};
